<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è§†é¢‘æ‰‘å…‹ (å¼ƒç‰Œæ¨¡å¼)</title>
    <style>
        body {
            background-color: #2c0e0e; 
            color: white;
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            user-select: none;
        }

        /* èµ”ç‡è¡¨æ ·å¼ (ä¿æŒä¸å˜) */
        .paytable {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            background: #4a1a1a;
            padding: 15px;
            border: 2px solid #a37c48;
            border-radius: 8px;
            margin-top: 20px;
            width: 80%;
            max-width: 600px;
            font-size: 14px;
        }
        .paytable div {
            display: flex;
            justify-content: space-between;
        }
        .highlight {
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 5px orange;
        }

        /* ç‰Œæ¡ŒåŒºåŸŸ */
        .game-area {
            display: flex;
            gap: 10px;
            margin: 40px 0;
        }

        .card {
            width: 100px;
            height: 140px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: black;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            border: 4px solid transparent;
            transition: transform 0.2s, opacity 0.2s; /* å¢åŠ ä¸€ç‚¹é€æ˜åº¦è¿‡æ¸¡ */
        }
        
        .card.red { color: #d00; }
        .card.black { color: #000; }
        .card.joker { color: purple; }

        /* === ä¿®æ”¹æ ¸å¿ƒï¼šå¼ƒç‰Œæ ·å¼ === */
        /* é€‰ä¸­è¦æ¢æ‰çš„ç‰Œï¼šè¾¹æ¡†å˜çº¢ï¼Œä½ç½®ä¸‹æ²‰ï¼Œå˜æš— */
        .card.discard {
            border-color: #ff4444;
            transform: translateY(15px); /* å‘ä¸‹æ²‰ï¼Œæ„Ÿè§‰æ˜¯è¦ä¸¢å¼ƒ */
            opacity: 0.7; /* å˜æš—ä¸€ç‚¹ */
            background-color: #ddd;
        }
        .card.discard::after {
            content: "æ¢æ‰"; /* æ–‡å­—æç¤º */
            position: absolute;
            top: -25px; /* æ˜¾ç¤ºåœ¨ä¸Šé¢ï¼Œä»¥å…é®æŒ¡ç‰Œé¢ */
            color: white;
            font-size: 14px;
            background: #ff4444;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* æŒ‰é’®å’Œä¿¡æ¯åŒºåŸŸ */
        .controls {
            text-align: center;
        }
        button {
            padding: 15px 40px;
            font-size: 20px;
            background: #d4a017;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px;
            box-shadow: 0 4px 0 #8c6a0f;
        }
        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
            box-shadow: none;
        }

        .status {
            margin-bottom: 10px;
            font-size: 20px;
            color: #ffd700;
            min-height: 30px;
        }
        .balance {
            margin-top: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <div class="paytable" id="paytable">
        <div id="row-royal"><span>çš‡å®¶åŒèŠ±é¡º</span><span>x100</span></div>
        <div id="row-flush"><span>åŒèŠ±</span><span>x4</span></div>
        <div id="row-five"><span>äº”æ¡ (å¸¦é¬¼ç‰Œ)</span><span>x50</span></div>
        <div id="row-straight"><span>é¡ºå­</span><span>x3</span></div>
        <div id="row-strflush"><span>åŒèŠ±é¡º</span><span>x20</span></div>
        <div id="row-three"><span>ä¸‰æ¡</span><span>x1</span></div>
        <div id="row-four"><span>å››æ¡</span><span>x10</span></div>
        <div id="row-twopair"><span>ä¸¤å¯¹</span><span>x1</span></div>
        <div id="row-full"><span>è‘«èŠ¦</span><span>x5</span></div>
        <div id="row-pair"><span>ä¸€å¯¹Â·æ•£ç‰Œ</span><span>x0</span></div>
    </div>

    <div class="game-area" id="card-container">
        </div>

    <div class="controls">
        <div class="status" id="status-text">å‡†å¤‡å¼€å§‹</div>
        <button id="action-btn" onclick="handleAction()">å‘ç‰Œ (Deal)</button>
        <div class="balance">ä½™é¢: <span id="money">100</span></div>
    </div>

<script>
    // === æ¸¸æˆé…ç½® ===
    const SUITS = ['â™ ', 'â™¥', 'â™£', 'â™¦'];
    const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let deck = [];
    let hand = [];
    let gameState = 'DEAL'; 
    let money = 100;
    const BET = 1;

    const cardContainer = document.getElementById('card-container');
    const actionBtn = document.getElementById('action-btn');
    const statusText = document.getElementById('status-text');
    const moneyDisplay = document.getElementById('money');

    for(let i=0; i<5; i++) {
        let div = document.createElement('div');
        div.className = 'card';
        div.onclick = () => toggleDiscard(i); // ä¿®æ”¹äº†ç‚¹å‡»äº‹ä»¶å
        div.innerHTML = '?';
        cardContainer.appendChild(div);
    }

    // === æ ¸å¿ƒé€»è¾‘ ===

    function createDeck() {
        let d = [];
        for (let s of SUITS) {
            for (let r of RANKS) {
                // ä¿®æ”¹ï¼šè¿™é‡Œåˆå§‹åŒ– isDiscard ä¸º false
                d.push({ suit: s, rank: r, val: RANKS.indexOf(r) + 2, isJoker: false, isDiscard: false });
            }
        }
        d.push({ suit: 'JOKER', rank: 'JOKER', val: 99, isJoker: true, isDiscard: false });
        return d;
    }

    function shuffle(d) {
        for (let i = d.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [d[i], d[j]] = [d[j], d[i]];
        }
        return d;
    }

    function handleAction() {
        if (gameState === 'DEAL') {
            if (money < BET) {
                alert("ä½™é¢ä¸è¶³ï¼");
                return;
            }
            money -= BET;
            updateUI();
            
            deck = shuffle(createDeck());
            hand = [];
            for(let i=0; i<5; i++) {
                // é»˜è®¤æ‰€æœ‰ç‰Œéƒ½ä¸ä¸¢å¼ƒ
                hand.push({ ...deck.pop(), isDiscard: false });
            }
            
            gameState = 'DRAW';
            actionBtn.innerText = "ç¡®è®¤æ¢ç‰Œ (Draw)";
            statusText.innerText = "ç‚¹å‡»ä½ ä¸æƒ³è¦çš„ç‰Œ..."; // æç¤ºè¯­å˜äº†
            clearHighlights();
            renderHand();
        } 
        else if (gameState === 'DRAW') {
            // === ä¿®æ”¹ï¼šåªæ›¿æ¢è¢«æ ‡è®°ä¸º isDiscard çš„ç‰Œ ===
            for(let i=0; i<5; i++) {
                if (hand[i].isDiscard) {
                    hand[i] = { ...deck.pop(), isDiscard: false };
                }
            }
            
            renderHand();
            evaluateHand(); 
            
            gameState = 'DEAL';
            actionBtn.innerText = "å†æ¬¡å‘ç‰Œ (Deal)";
        }
    }

    // === ä¿®æ”¹ï¼šåˆ‡æ¢å¼ƒç‰ŒçŠ¶æ€ ===
    function toggleDiscard(index) {
        if (gameState !== 'DRAW') return;
        hand[index].isDiscard = !hand[index].isDiscard;
        renderHand();
    }

    function renderHand() {
        const divs = cardContainer.children;
        for(let i=0; i<5; i++) {
            const card = hand[i];
            const div = divs[i];
            
            // === ä¿®æ”¹ï¼šæ£€æŸ¥ isDiscard ===
            div.className = `card ${card.isDiscard ? 'discard' : ''}`;
            
            if (card.isJoker) {
                div.innerHTML = "ğŸ¤¡<br><small>JOKER</small>";
                div.classList.add('joker');
            } else {
                div.innerHTML = `${card.rank}<br>${card.suit}`;
                if (card.suit === 'â™¥' || card.suit === 'â™¦') {
                    div.classList.add('red');
                    div.classList.remove('black');
                } else {
                    div.classList.add('black');
                    div.classList.remove('red');
                }
            }
        }
        updateUI();
    }

    function updateUI() {
        moneyDisplay.innerText = money;
    }

    function clearHighlights() {
        document.querySelectorAll('.paytable div').forEach(el => el.classList.remove('highlight'));
    }

    // === ç®—æ³•éƒ¨åˆ†ä¿æŒä¸å˜ ===
    function evaluateHand() {
        let jokers = hand.filter(c => c.isJoker).length;
        let normalCards = hand.filter(c => !c.isJoker);
        let counts = {};
        let suits = {};
        normalCards.forEach(c => {
            counts[c.val] = (counts[c.val] || 0) + 1;
            suits[c.suit] = (suits[c.suit] || 0) + 1;
        });

        let maxCount = 0; 
        for(let k in counts) maxCount = Math.max(maxCount, counts[k]);
        let maxSuit = 0; 
        for(let k in suits) maxSuit = Math.max(maxSuit, suits[k]);

        let isStraight = checkStraight(normalCards, jokers);
        let isFlush = (maxSuit + jokers) >= 5;
        let isRoyal = false;

        if (isFlush && isStraight) {
            let royalCards = normalCards.filter(c => c.val >= 10);
            if (royalCards.length + jokers >= 5) isRoyal = true;
        }

        let win = 0;
        let msg = "æœªä¸­å¥–";
        let highlightId = "";

        if (isRoyal) { win = 100; msg = "çš‡å®¶åŒèŠ±é¡º!"; highlightId = "row-royal"; }
        else if ((maxCount + jokers) >= 5) { win = 50; msg = "äº”æ¡!"; highlightId = "row-five"; }
        else if (isFlush && isStraight) { win = 20; msg = "åŒèŠ±é¡º!"; highlightId = "row-strflush"; }
        else if ((maxCount + jokers) === 4) { win = 10; msg = "å››æ¡!"; highlightId = "row-four"; }
        else if (checkFullHouse(counts, jokers)) { win = 5; msg = "è‘«èŠ¦!"; highlightId = "row-full"; }
        else if (isFlush) { win = 4; msg = "åŒèŠ±!"; highlightId = "row-flush"; }
        else if (isStraight) { win = 3; msg = "é¡ºå­!"; highlightId = "row-straight"; }
        else if ((maxCount + jokers) === 3) { win = 1; msg = "ä¸‰æ¡!"; highlightId = "row-three"; }
        else if (checkTwoPair(counts, jokers)) { win = 1; msg = "ä¸¤å¯¹!"; highlightId = "row-twopair"; }

        if (win > 0) {
            money += win * BET;
            statusText.innerText = `${msg} èµ¢å¾— ${win} å€!`;
            if(highlightId) document.getElementById(highlightId).classList.add('highlight');
        } else {
            statusText.innerText = "å¾ˆé—æ†¾ï¼Œæœªä¸­å¥–ã€‚";
        }
        updateUI();
    }

    function checkStraight(cards, jokerCount) {
        if (cards.length === 0) return true;
        let vals = cards.map(c => c.val).sort((a,b) => a-b);
        vals = [...new Set(vals)]; 
        if (vals.length + jokerCount < 5) return false;
        let gap = vals[vals.length-1] - vals[0];
        if (gap <= 4) return true;
        return false; 
    }

    function checkFullHouse(counts, jokers) {
        let values = Object.values(counts);
        if (values.length === 2) return true;
        if (values.length === 1 && jokers >= 1) return true;
        return false;
    }

    function checkTwoPair(counts, jokers) {
        let pairs = 0;
        for(let k in counts) if (counts[k] >= 2) pairs++;
        if (pairs >= 2) return true;
        if (pairs === 1 && jokers >= 1) return true;
        if (jokers >= 2) return true;
        return false;
    }
</script>

</body>
</html>
