<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Casino Video Poker</title>
    <style>
        /* === 1. èµŒåœºç»¿ç»’å¸ƒèƒŒæ™¯ === */
        body {
            /* ä½¿ç”¨å¾„å‘æ¸å˜æ¨¡æ‹Ÿèšå…‰ç¯æ•ˆæœ */
            background: radial-gradient(circle at center, #358c35 0%, #003300 100%);
            color: white;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            overflow-x: hidden;
        }

        /* === 2. é»‘é‡‘é£æ ¼èµ”ç‡è¡¨ === */
        .paytable {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            /* åŠé€æ˜é»‘è‰²ç»ç’ƒè´¨æ„Ÿ */
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            /* é‡‘è‰²è¾¹æ¡† */
            border: 3px solid #ffd700;
            border-radius: 12px;
            margin-top: 30px;
            width: 85%;
            max-width: 650px;
            font-size: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .paytable div {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            padding-bottom: 2px;
        }
        /* ä¸­å¥–é«˜äº®ï¼šéœ“è™¹é—ªçƒæ•ˆæœ */
        .highlight {
            color: #fff;
            background-color: #b8860b;
            padding: 0 5px;
            border-radius: 4px;
            box-shadow: 0 0 15px #ffd700;
            animation: pulse 0.8s infinite alternate;
        }
        @keyframes pulse {
            from { box-shadow: 0 0 10px #ffd700; }
            to { box-shadow: 0 0 25px #ffaa00; }
        }

        /* === 3. ç‰Œæ¡ŒåŒºåŸŸ === */
        .game-area {
            display: flex;
            gap: 15px;
            margin: 50px 0;
            perspective: 1000px; /* å¢åŠ ä¸€ç‚¹é€è§†æ„Ÿ */
        }

        .card {
            width: 110px;
            height: 154px;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #333;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.4);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid #ccc;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .card.red { color: #d00; }
        .card.black { color: #222; }
        .card.joker { color: #800080; }

        /* === 4. å¼ƒç‰Œæ ·å¼ (Discard) === */
        .card.discard {
            transform: translateY(20px) scale(0.95);
            filter: brightness(0.6) sepia(0.2); /* å˜æš—å¹¶å¸¦ç‚¹å¤å¤é»„ */
            border-color: #cc0000;
        }
        .card.discard::after {
            content: "âœ˜ æ¢ç‰Œ";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            color: #fff;
            font-size: 18px;
            background: rgba(200, 0, 0, 0.9);
            padding: 5px 10px;
            border: 2px solid white;
            border-radius: 4px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* === 5. èµŒåœºæ°›å›´æ§åˆ¶åŒº === */
        .controls {
            text-align: center;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
        }

        .status {
            margin-bottom: 20px;
            font-size: 24px;
            color: #ffd700; /* é‡‘è‰²å­—ä½“ */
            text-shadow: 2px 2px 2px #000;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            min-height: 35px;
        }

        /* === å®ä½“æŒ‰é’®è®¾è®¡ === */
        button {
            padding: 15px 50px;
            font-size: 24px;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            border: none;
            border-radius: 50px; /* èƒ¶å›Šå½¢çŠ¶ */
            
            /* 3D çº¢è‰²æŒ‰é’®æ¸å˜ */
            background: linear-gradient(to bottom, #ff4d4d 0%, #cc0000 100%);
            /* åº•éƒ¨é˜´å½±æ¨¡æ‹Ÿåšåº¦ */
            box-shadow: 
                0 6px 0 #8b0000, 
                0 10px 10px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.4);
            
            transition: all 0.1s;
            position: relative;
        }

        button:active {
            transform: translateY(6px); /* æŒ‰ä¸‹æ•ˆæœ */
            box-shadow: 
                0 0 0 #8b0000, 
                inset 0 2px 5px rgba(0,0,0,0.5);
            background: linear-gradient(to bottom, #cc0000 0%, #aa0000 100%);
        }

        button:disabled {
            background: #555;
            box-shadow: none;
            color: #aaa;
            cursor: not-allowed;
            transform: translateY(6px);
        }

        .balance-box {
            margin-top: 25px;
            display: inline-block;
            background: #000;
            border: 2px solid #555;
            padding: 10px 30px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            color: #0f0; /* è€å¼ç”µå­å±ç»¿è‰² */
            font-size: 20px;
            box-shadow: inset 0 0 10px #000;
        }
    </style>
</head>
<body>

    <div class="paytable" id="paytable">
        <div id="row-royal"><span>çš‡å®¶åŒèŠ±é¡º</span><span>x100</span></div>
        <div id="row-five"><span>äº”æ¡ (å¸¦é¬¼ç‰Œ)</span><span>x50</span></div>
        <div id="row-strflush"><span>åŒèŠ±é¡º</span><span>x20</span></div>
        <div id="row-four"><span>å››æ¡</span><span>x10</span></div>
        <div id="row-full"><span>è‘«èŠ¦</span><span>x5</span></div>
        <div id="row-flush"><span>åŒèŠ±</span><span>x4</span></div>
        <div id="row-straight"><span>é¡ºå­</span><span>x3</span></div>
        <div id="row-three"><span>ä¸‰æ¡</span><span>x1</span></div>
        <div id="row-twopair"><span>ä¸¤å¯¹</span><span>x1</span></div>
        <div id="row-pair"><span>ä¸€å¯¹ (æ— åˆ†)</span><span>x0</span></div>
    </div>

    <div class="game-area" id="card-container">
        </div>

    <div class="controls">
        <div class="status" id="status-text">PRESS DEAL TO START</div>
        <button id="action-btn" onclick="handleAction()">DEAL</button>
        <br>
        <div class="balance-box">CREDIT: $<span id="money">100</span></div>
    </div>

<script>
    // === æ¸¸æˆé€»è¾‘ (ä¿æŒå¼ƒç‰Œæ¨¡å¼ä¸å˜) ===
    const SUITS = ['â™ ', 'â™¥', 'â™£', 'â™¦'];
    const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let deck = [];
    let hand = [];
    let gameState = 'DEAL'; 
    let money = 100;
    const BET = 1;

    const cardContainer = document.getElementById('card-container');
    const actionBtn = document.getElementById('action-btn');
    const statusText = document.getElementById('status-text');
    const moneyDisplay = document.getElementById('money');

    // åˆå§‹åŒ–ç©ºç‰Œä½
    for(let i=0; i<5; i++) {
        let div = document.createElement('div');
        div.className = 'card';
        div.onclick = () => toggleDiscard(i);
        // åˆå§‹èƒŒé¢èŠ±çº¹ç®€å•æ¨¡æ‹Ÿ
        div.style.background = `repeating-linear-gradient(45deg, #cc0000, #cc0000 10px, #aa0000 10px, #aa0000 20px)`;
        div.style.border = '2px solid white';
        cardContainer.appendChild(div);
    }

    function createDeck() {
        let d = [];
        for (let s of SUITS) {
            for (let r of RANKS) {
                d.push({ suit: s, rank: r, val: RANKS.indexOf(r) + 2, isJoker: false, isDiscard: false });
            }
        }
        d.push({ suit: 'JOKER', rank: 'JOKER', val: 99, isJoker: true, isDiscard: false });
        return d;
    }

    function shuffle(d) {
        for (let i = d.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [d[i], d[j]] = [d[j], d[i]];
        }
        return d;
    }

    function handleAction() {
        if (gameState === 'DEAL') {
            if (money < BET) {
                statusText.innerText = "INSERT COIN (åˆ·æ–°é¡µé¢)";
                return;
            }
            money -= BET;
            updateUI();
            
            deck = shuffle(createDeck());
            hand = [];
            for(let i=0; i<5; i++) {
                hand.push({ ...deck.pop(), isDiscard: false });
            }
            
            gameState = 'DRAW';
            actionBtn.innerText = "DRAW";
            statusText.innerText = "SELECT CARDS TO DISCARD";
            clearHighlights();
            renderHand();
        } 
        else if (gameState === 'DRAW') {
            for(let i=0; i<5; i++) {
                if (hand[i].isDiscard) {
                    hand[i] = { ...deck.pop(), isDiscard: false };
                }
            }
            
            renderHand();
            evaluateHand(); 
            
            gameState = 'DEAL';
            actionBtn.innerText = "DEAL";
        }
    }

    function toggleDiscard(index) {
        if (gameState !== 'DRAW') return;
        hand[index].isDiscard = !hand[index].isDiscard;
        renderHand();
    }

    function renderHand() {
        const divs = cardContainer.children;
        for(let i=0; i<5; i++) {
            const card = hand[i];
            const div = divs[i];
            
            // é‡ç½®æ ·å¼ï¼ˆè¦†ç›–æ‰åˆå§‹èƒŒé¢çš„æ ·å¼ï¼‰
            div.style.background = ''; 
            div.style.background = 'linear-gradient(135deg, #fff 0%, #f0f0f0 100%)';
            div.style.border = '2px solid #ccc';

            div.className = `card ${card.isDiscard ? 'discard' : ''}`;
            
            if (card.isJoker) {
                div.innerHTML = "ğŸ¤¡<br><small>JOKER</small>";
                div.classList.add('joker');
                div.classList.remove('red', 'black');
            } else {
                div.innerHTML = `${card.rank}<br>${card.suit}`;
                if (card.suit === 'â™¥' || card.suit === 'â™¦') {
                    div.classList.add('red');
                    div.classList.remove('black', 'joker');
                } else {
                    div.classList.add('black');
                    div.classList.remove('red', 'joker');
                }
            }
        }
        updateUI();
    }

    function updateUI() {
        moneyDisplay.innerText = money;
    }

    function clearHighlights() {
        document.querySelectorAll('.paytable div').forEach(el => el.classList.remove('highlight'));
    }

    // === ç®€å•çš„ç»“ç®—é€»è¾‘ ===
    function evaluateHand() {
        let jokers = hand.filter(c => c.isJoker).length;
        let normalCards = hand.filter(c => !c.isJoker);
        let counts = {};
        let suits = {};
        normalCards.forEach(c => {
            counts[c.val] = (counts[c.val] || 0) + 1;
            suits[c.suit] = (suits[c.suit] || 0) + 1;
        });

        let maxCount = 0; 
        for(let k in counts) maxCount = Math.max(maxCount, counts[k]);
        let maxSuit = 0; 
        for(let k in suits) maxSuit = Math.max(maxSuit, suits[k]);

        let isStraight = checkStraight(normalCards, jokers);
        let isFlush = (maxSuit + jokers) >= 5;
        let isRoyal = false;

        if (isFlush && isStraight) {
            let royalCards = normalCards.filter(c => c.val >= 10);
            if (royalCards.length + jokers >= 5) isRoyal = true;
        }

        let win = 0;
        let msg = "GAME OVER";
        let highlightId = "";

        if (isRoyal) { win = 100; msg = "ROYAL FLUSH!!"; highlightId = "row-royal"; }
        else if ((maxCount + jokers) >= 5) { win = 50; msg = "FIVE OF A KIND!"; highlightId = "row-five"; }
        else if (isFlush && isStraight) { win = 20; msg = "STRAIGHT FLUSH"; highlightId = "row-strflush"; }
        else if ((maxCount + jokers) === 4) { win = 10; msg = "FOUR OF A KIND"; highlightId = "row-four"; }
        else if (checkFullHouse(counts, jokers)) { win = 5; msg = "FULL HOUSE"; highlightId = "row-full"; }
        else if (isFlush) { win = 4; msg = "FLUSH"; highlightId = "row-flush"; }
        else if (isStraight) { win = 3; msg = "STRAIGHT"; highlightId = "row-straight"; }
        else if ((maxCount + jokers) === 3) { win = 1; msg = "THREE OF A KIND"; highlightId = "row-three"; }
        else if (checkTwoPair(counts, jokers)) { win = 1; msg = "TWO PAIR"; highlightId = "row-twopair"; }

        if (win > 0) {
            money += win * BET;
            statusText.innerText = `${msg} WIN ${win}!`;
            if(highlightId) document.getElementById(highlightId).classList.add('highlight');
        } else {
            statusText.innerText = msg;
        }
        updateUI();
    }

    function checkStraight(cards, jokerCount) {
        if (cards.length === 0) return true;
        let vals = cards.map(c => c.val).sort((a,b) => a-b);
        vals = [...new Set(vals)]; 
        if (vals.length + jokerCount < 5) return false;
        let gap = vals[vals.length-1] - vals[0];
        if (gap <= 4) return true;
        return false; 
    }

    function checkFullHouse(counts, jokers) {
        let values = Object.values(counts);
        if (values.length === 2) return true;
        if (values.length === 1 && jokers >= 1) return true;
        return false;
    }

    function checkTwoPair(counts, jokers) {
        let pairs = 0;
        for(let k in counts) if (counts[k] >= 2) pairs++;
        if (pairs >= 2) return true;
        if (pairs === 1 && jokers >= 1) return true;
        if (jokers >= 2) return true;
        return false;
    }
</script>

</body>
</html>
